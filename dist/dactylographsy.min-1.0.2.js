!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=c(1),f=d(e);"undefined"!=typeof window&&(window.dactylographsy=new f["default"]({autorun:!0}))},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(2),h=d(g),i=c(4),j=d(i),k=c(3),l=d(k),m=function(){function a(){e(this,a);var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=b.autorun,d=void 0===c?!1:c,f=b.enableLogging,g=void 0===f?!1:f;this.log=new l["default"](g),this.hookIntoDom(),this.readConfiguration(),this.cache=new h["default"]({appPrefix:this.config.appPrefix}),d&&this.run()}return f(a,[{key:"hookIntoDom",value:function(){"undefined"!=typeof document&&(this.executingScript=document.getElementById("dactylographsy"),this.injectInto=document.body||document.head||document.getElementsByTagName("script")[0])}},{key:"readConfiguration",value:function(){this.manifestUrls=this.readAttrOnScript("manifests"),this.config=this.readAttrOnScript("config")}},{key:"refresh",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return Promise.all(this.manifestUrls.map(function(b){return new i.Manifest(b,a.config).get()})).then(function(c){return a.log.info("Fetched all manifests, "+c.length+" in total."),a.cache.set(c,"manifests","manifests"),new j["default"](b?a.injectInto:void 0,c,a.config).inject()})}},{key:"restore",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return this.cache.get("manifests").then(function(c){return a.log.info("Resotring with manifests in cache later refreshing via network (delayed)."),new j["default"](b?a.injectInto:void 0,c,a.config).inject()})}},{key:"readAttrOnScript",value:function(a){if(!this.executingScript)return!1;var b=this.executingScript.getAttribute("data-"+a);return b?JSON.parse(b):void 0}},{key:"run",value:function(){var a=this;return this.config.ttl&&this.cache.get("clt",0).then(function(b){b>=a.config.ttl?(a.log.info("Flushing cache due to exeeding TTL of "+a.config.ttl+"."),a.cache.flush()):a.cache.set(++b,"plain","clt")}),this.config.cacheManifests===!1?this.refresh():this.restore().then(function(b){var c=a.config.refreshDelay,d=void 0===c?5e3:c;return new Promise(function(c,e){window.setTimeout(function(){a.refresh(b).then(c,e)},d)})})["catch"](function(){return a.log.info("No manifests in cache, refreshing via network."),a.refresh()})}}]),a}();b["default"]=m},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(3),h=d(g),i=function(){function a(){e(this,a);var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c="__dactylographsy",d=b.enableLogging,f=void 0===d?!1:d;this.log=new h["default"](f),this.options=b,this.cachePrefix=this.options.cachePrefix||c,this.isSupported=this.supported(),this.options.appPrefix?this.cachePrefix=this.cachePrefix+"--"+this.options.appPrefix:this.options.cachePrefix||(this.cachePrefix+="__")}return f(a,[{key:"getPrefix",value:function(){return this.cachePrefix}},{key:"get",value:function(a,b){var c=this;return new Promise(function(d,e){c.isSupported||e();var f=JSON.parse(localStorage.getItem(c.cachePrefix+"-"+a));return null===f&&void 0!==b?(c.set(b,"plain",a),void d(b)):void(f?(c.log.info("Found item with key: "+a+" in cache."),d(f.code)):(c.log.info("Couldn't find item with key: "+a+" in cache."),e()))})}},{key:"has",value:function(a){return this.isSupported?null!==localStorage.getItem(this.cachePrefix+"-"+a):!1}},{key:"set",value:function(a,b,c){var d=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(!this.isSupported)return!1;d&&this.dedupe(d);var e={now:+new Date,url:c,code:a,type:b,singularBy:"string"==typeof d?d:void 0};return localStorage.setItem(this.cachePrefix+"-"+c,JSON.stringify(e)),e}},{key:"flush",value:function(){if(!this.isSupported)return!1;for(var a in localStorage)a.indexOf(this.cachePrefix)>=0&&(this.log.log("Removing item "+a+" requested by flush."),localStorage.removeItem(a));return!0}},{key:"supported",value:function(){var a="__dactylographsy__feature-detection";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return this.log.warn("Localstorage not supported in browser - no caching!"),!1}}},{key:"dedupe",value:function(a){for(var b in localStorage){var c=b.indexOf(this.cachePrefix)>=0,d=void 0;c&&(d=JSON.parse(localStorage.getItem(b)),"string"==typeof a&&"string"==typeof d.singularBy&&d.singularBy===a&&(this.log.log("Deduping by "+a+" before adding dupe in "+b+"."),localStorage.removeItem(b)))}}}]),a}();b["default"]=i},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){c(this,a);var b=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.enabled=b,this.enabled&&(this.console=window.console)}return d(a,[{key:"log",value:function(){if(this.enabled){var a;(a=this.console).log.apply(a,arguments)}}},{key:"info",value:function(){if(this.enabled){var a;(a=this.console).info.apply(a,arguments)}}},{key:"warn",value:function(){if(this.enabled){var a;(a=this.console).warn.apply(a,arguments)}}},{key:"debug",value:function(){if(this.enabled){var a;(a=this.console).debug.apply(a,arguments)}}},{key:"error",value:function(){if(this.enabled){var a;(a=this.console).error.apply(a,arguments)}}}]),a}();b["default"]=e},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0}),b.Manifest=void 0;var g=c(5),h=c(6),i=d(h),j=c(3),k=d(j),l=(b.Manifest=function(){function a(b,c){e(this,a);var d=c.enableLogging,f=void 0===d?!1:d;this.log=new k["default"](f),this.url=b}return f(a,[{key:"get",value:function(){var a=this;return(new i["default"]).get(this.url).then(function(b){var c=b.text,d=b.url;return a.log.info("Fetched manifest from url: "+d+"."),JSON.parse(c)},function(b){a.log.error("Could not fetch manifest with url: "+b.responseURL+"!")})}}]),a}(),function(){function a(b,c){var d=this;e(this,a);var f=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],g=f.enableLogging,h=void 0===g?!1:g;this.log=new k["default"](h),this.manifests={},this.injectInto=b,c.forEach(function(a){d.manifests[a["package"]]=a}),this.options=f,this.prefix=f.prefix,this.order=f.order}return f(a,[{key:"inject",value:function(){var a=this,b=function d(a){return a.reduce(function(a,b){return a.concat(Array.isArray(b)?d(b):b)},[])},c=function e(b){var c=arguments.length<=1||void 0===arguments[1]?0:arguments[1],d=b[c];void 0!==d&&(d.getAttribute("data-dactylographsy-uncached-js")?(a.injectInto.appendChild(d),d.addEventListener("load",function(){e(b,++c)}),d.addEventListener("error",function(){e(b,++c)})):(a.injectInto.appendChild(d),e(b,++c)))};return Promise.all(this.order.map(function(b){return a.manifests[b]?a.injectManifest(a.manifests[b]):(a.log.error("Couldn't find package "+b+" from injection order."),Promise.reject())})).then(function(a){var d=b(a);return c(d),Promise.resolve(d)})}},{key:"injectManifest",value:function(a){var b=this,c=Object.keys(a.hashes);return Promise.all(c.map(function(c){var d=a.hashes[c],e=void 0;return e=[a.rootUrl,a.packageUrl].filter(function(a){return void 0!==a&&null!==a}).join("/"),b.injectDependency(d,e)}))}},{key:"injectDependency",value:function(a,b){switch(a.extension){case".css":return new g.Css(void 0,this.options).inject(this.urls(a,b));case".js":return new g.Js(void 0,this.options).inject(this.urls(a,b));default:Promise.resolve(!1)}}},{key:"basename",value:function(a){return a.replace(/.*\/|\.[^.]*$/g,"")}},{key:"urls",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=this.basename(a.file),d=void 0;return d=[this.prefix,b,a.path].filter(function(a){return void 0!==a&&null!==a}).join("/"),{printed:"/"+d+"/"+c+"-"+a.hash+a.extension,raw:"/"+d+"/"+c+a.extension,singularBy:"/"+d+"/"+c+a.extension}}}]),a}());b["default"]=l},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0}),b.Css=b.Js=void 0;var g=c(2),h=d(g),i=c(6),j=d(i),k=c(3),l=d(k);b.Js=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e(this,a);var d=c.enableLogging,f=void 0===d?!1:d;this.injectInto=b,this.cache=new h["default"]({appPrefix:c.appPrefix,enableLogging:f}),this.cacheDelay=c.cacheDelay||5e3,this.log=new l["default"](f)}return f(a,[{key:"injectWithText",value:function(a,b){var c=this;return new Promise(function(d){var e=document.createElement("script");e.defer=!1,e.async=!1,e.setAttribute("data-dactylographsy-url",b),e.text=a,d(c.injectInto?c.injectInto.appendChild(e):e)})}},{key:"injectWithUrl",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?"printed":arguments[1];return new Promise(function(d){var e=document.createElement("script"),f=a[c];b.log.info("Injecting JavaScript from "+f+"."),e.async=!1,e.defer=!1,e.setAttribute("data-dactylographsy-url",f),e.setAttribute("data-dactylographsy-uncached-js",!0),e.readyState?e.onreadystatechange=function(){("loaded"===e.readyState||"complete"===e.readyState)&&(e.onreadystatechange=null,b.ensureCache(f,a.singularBy,b.cacheDelay))}:(e.onload=function(){"printed"===c&&b.ensureCache(f,a.singularBy,b.cacheDelay)},e.onerror=function(){b.log.info("Could not fetch JavaScript from "+f+" - falling back to unprinted version."),"printed"===c&&b.injectWithUrl(a,"raw")}),e.src=f,d(b.injectInto?b.injectInto.appendChild(e):e)})}},{key:"ensureCache",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],d=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return new Promise(function(e,f){b.cache.has(a)&&e(),b.log.info("Loading JavaScript from "+a+" for cache in "+d+"."),window.setTimeout(function(){return(new j["default"]).get(a).then(function(d){var f=d.text;b.cache.set(f,"js",a,c),b.log.info("Loaded JavaScript from "+a+" now cached."),e()})["catch"](function(){f()})},d)})}},{key:"inject",value:function(a){var b=this;return this.cache.get(a.printed).then(function(c){return b.injectWithText(c,a.printed)},function(){return b.injectWithUrl(a)})}}]),a}(),b.Css=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e(this,a);var d=c.enableLogging,f=void 0===d?!1:d;this.injectInto=b,this.cache=new h["default"]({appPrefix:c.appPrefix}),this.cacheDelay=c.cacheDelay||5e3,this.log=new l["default"](f)}return f(a,[{key:"ensureCache",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],d=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return new Promise(function(e,f){b.cache.has(a)&&e(),b.log.info("Loading CSS from "+a+" for cache in "+d+"."),window.setTimeout(function(){return(new j["default"]).get(a).then(function(d){var f=d.text;b.cache.set(f,"css",a,c),b.log.info("Loaded CSS from "+a+" now cached."),e()})["catch"](function(){f()})},d)})}},{key:"injectWithUrl",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?"printed":arguments[1];return new Promise(function(d){var e=document.createElement("link"),f=a[c];e=document.createElement("link"),e.type="text/css",e.rel="stylesheet",e.setAttribute("data-dactylographsy-url",f),e.setAttribute("data-dactylographsy-uncached-css",!0),e.href=f,"printed"===c&&b.ensureCache(f,a.singularBy,b.cacheDelay)["catch"](function(){b.log.info("Could not fetch CSS from "+f+" - falling back to unprinted version."),b.injectWithUrl(a,"raw")}),d(b.injectInto?b.injectInto.appendChild(e):e)})}},{key:"injectWithText",value:function(a,b){var c=this;return new Promise(function(d){var e=document.createElement("link");e=document.createElement("style"),e.setAttribute("data-dactylographsy-url",b),e.textContent=a,d(c.injectInto?c.injectInto.appendChild(e):e)})}},{key:"inject",value:function(a){var b=this;return this.cache.get(a.printed).then(function(c){return b.injectWithText(c,a.printed)},function(){return b.injectWithUrl(a)})}}]),a}()},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){c(this,a)}return d(a,[{key:"get",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new Promise(function(c,d){var e=new XMLHttpRequest;"withCredentials"in e?e.open("GET",a,!0):"undefined"!=typeof XDomainRequest?(e=new XDomainRequest,e.open("GET",a)):e=null,b.withCredentials&&(e.withCredentials=!0),e.onload=function(){e.status>=400?d(e):c({xhr:e,text:e.responseText,url:e.responseURL})},e.onerror=function(){d(e)},e.send()})}}]),a}();b["default"]=e}]);